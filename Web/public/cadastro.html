<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>CyberWise | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="icon" href="./assets/logoCWpreta.png" />
  <link rel="stylesheet" href="./css/cadastro.css" />
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>


  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/header_footer.css">
  <link rel="stylesheet" href="particles/particles.css">
</head>

<body id="particles-js">
  <header class="cabecalho">
    <div class="container_cabecalho">
        <div class="container_logo">
            <img src="./assets/logoCWbranca.png" alt="Logo da empresa CyberWise" class="logo_img">
        </div>
        <nav class="container_nav">
            <ul>
              <li><a href="./index.html" id="letraPreta">Home</a></li>
              <li><a href="./login.html" id="letraPreta4">Login</a></li>
              <li><a href="./cadastro.html" id="letraPreta5">Cadastro</a></li>
            </ul>
        </nav>
        <button id="btnMenu">
            <i class='bx bx-menu'></i>
        </button>
        <nav class="container_nav-mob" id="navBarMobile">
            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="./login.html">Login</a></li>
                <li><a href="./cadastro.html">Cadastro</a></li>
            </ul>
        </nav>
    </div>
</header>
<div class="credenciasisGeradas" id="boxCredencial">
  <div class="imgCenter" style="text-align: center;"><img width="50px" src="./assets/logoCUBOCYBER - Copia.png" alt=""></div>
  <h2 class="tituloCredencial">Salve as suas credenciais</h2>
  <h3  class="labelsCredencial">E-mail:</h3>
  <div id="emailGerado" class="espacoParaCredencial"></div>
  <h3 class="labelsCredencial">Senha:</h3>
  <div id="senhaGerado" class="espacoParaCredencial"></div>
  <div class="divBtn">
  <a href="./login.html" class="btnConfirmar">Confirmar</a>

  </div>
</div>
<div id="containerCadastro" class="container_cadastro">
  <img src="assets/logoCUBOCYBER.png" alt="logoCUBOCYBER" class="cadastro_logocubo">
  <div class="container_titulo_cadastro">
    <h1>CYBERWISE account</h1>
    <h2>Cadastre a empresa</h2>
  </div>
  <div class="container_inputs">
  <div class="container_coluna_esquerda_cadastro">
    <div class="container_inputEtexto">
    <p>Nome</p>
    <input type="text" class="inputs_cadastro" id="nome_input">
  </div>
  <div class="container_inputEtexto">
    <p>CNPJ</p>
    <input type="text" class="inputs_cadastro" id="cnpj_input">
        <div class="container_inputEtexto">
      <p>Telefone</p>
      <input type="number" class="inputs_cadastro" id="telefone_input">
    </div>
  </div>
  </div>
</div>
  <div class="conteiner_termos_servico">
    <input type="checkbox" class="checkbox" id="checkboxid" onclick="teste()"><p>Concordo com os <a href="termos.html" class="texto_termos">termos de serviço</a> e a <a href="politicas.html" class="texto_termos">política de privacidade</a>.</p>
  </div>
  <div class="container_botao_cadastrar">
    <button class="botao_cadastro" onclick="gerarConta()">Cadastrar</button>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
<script src="./js/header.js"></script>  
</html>
<script type="text/JavaScript" src="particles/particles.js"></script>
<script type="text/JavaScript" src="particles/app.js"></script>
<script>
  var t = 1;
  function teste(){
    console.log(checkboxid.value);
      t++;
  }

    function gerarSenha(nomeEmpresa) {
    var numeros = `${nomeEmpresa}`;
    for (var i = 0; i < 6; i++) {
      numeros += Math.floor(Math.random() * 10); // Intervalo de 0 a 9
    }
    return numeros;
  }

  function gerarConta(){
    var politica = t % 2 == 0 ? true : false;
    console.log("politica ===> ",politica)
    console.log(t)
    var nomeVar = nome_input.value;
    var cnpjVar = cnpj_input.value;
    var telefoneVar = telefone_input.value;
    
    if (
      nomeVar == "" ||
      telefoneVar == "" ||
      cnpjVar == ""
    ) {
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
        });
        Toast.fire({
            title: "Erro",
        text: "Preencha todos os campos",
        icon: "error",
        color: "#fff",
        background: "#011126",
        iconColor : "red",
        });
    }else if(cnpjVar.length  != 11){
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
        });
        Toast.fire({
            title: "CNPJ",
        text: "Cnpj inválido!",
        icon: "error",
        color: "#fff",
        background: "#011126",
        iconColor : "red",
        });
    }else if(telefoneVar.length != 9){
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
        });
        Toast.fire({
            title: "Telefone",
        text: "Telefone inválido!",
        icon: "error",
        color: "#fff",
        background: "#011126",
        iconColor : "red",
        });
    }else if(!politica){
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
        });
        Toast.fire({
            title: "Erro",
        text: "Selecione a check-box",
        icon: "error",
        color: "#fff",
        background: "#011126",
        iconColor : "red",
        });
    }
    else{ 
      let nome = nomeVar.toLowerCase();
      nome = nome.replace(/\s/g, "");

      var emailAdm = `${nome}@cyberwise.com`;
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
        });
        Toast.fire({
            title: "Cadastro realizado",
        text: "Faça o login!",
        icon: "success",
        color: "#fff",
        background: "#011126",
        iconColor : "green",
        });

      var emailAdm = `${nome}@cyberwise42.com`;
      var nomeAdm = `${nomeVar} administrador`;
      var senhaVar  = gerarSenha(nome);

     // boxCredencial.style.display = 'block';
    //  setTimeout(function() {
    //    boxCredencial.style.opacity = '1'; // Aplica a transição de opacidade
    //  }, 10);
    //  containerCadastro.style.display = 'none'
      
    //  emailGerado.innerHTML = emailAdm
     // senhaGerado.innerHTML = senhaVar
      
      console.log('Email gerado ===>',emailAdm);
      console.log('Senha gerada ===>', senhaVar);
     // console.log('Nome Adm ===>', nomeAdm);

    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        nomeEmpresaServer: nome,
      //  nomeAdmServer : nomeAdm,
        cnpjServer: cnpjVar,
        telefoneServer : telefoneVar,
      //  emailServer : emailAdm,
       // senhaServer: senhaVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
       // console.log(resposta, 'resposta ok!!!!!!!!')
        console.log(`dentro resposta ok: ${JSON.stringify(resposta)}`);
        buscarEmpresa();
         
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;

   function buscarEmpresa() {
    fetch("/usuarios/buscarEmpresa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
      //  nomeEmpresaServer: nome,
      //  nomeAdmServer : nomeAdm,
      //  cnpjServer: cnpjVar,
      //  telefoneServer : telefoneVar,
      //  emailServer : emailAdm,
       // senhaServer: senhaVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ===>  ", resposta);

        if (resposta.ok) {

          resposta.json().then(json => {
            console.log(json);
            // console.log(JSON.stringify(json));
            
            cadastrarFuncionario(json.registros)

        });

         
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });}



    function cadastrarFuncionario(idEmpresa){
    // var fk_Empresa = idEmpresa
    console.log(idEmpresa)

      fetch("/usuarios/cadastrarFuncionario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
         // nomeEmpresaServer: nomeVar,
          nomeAdmServer : nomeVar,
        //  cnpjServer: cnpjVar,
         // telefoneServer : telefoneVar,
          emailServer : emailAdm,
          senhaServer: senhaVar,
          fkEmpresa : idEmpresa
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);
  
          if (resposta.ok) {
            boxCredencial.style.display = 'block'
            setTimeout(function() {
              boxCredencial.style.opacity = '1'; // Aplica a transição de opacidade
            }, 10);
      
            containerCadastro.style.display = 'none';
            
            emailGerado.innerHTML = emailAdm
            senhaGerado.innerHTML = senhaVar
            
  
  
           
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });
  
      return false;
    }
    }

  }




</script>